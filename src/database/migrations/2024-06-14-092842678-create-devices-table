-- Up

CREATE TABLE IF NOT EXISTS `devices`
  (
    `id` INT UNSIGNED AUTO_INCREMENT NOT NULL,
    `uuid` BINARY(16) NOT NULL,
    `ip` VARCHAR(32) NOT NULL,
    `ua` VARCHAR(512) NOT NULL,
    `account_id` INT UNSIGNED NOT NULL,
    `user_id` INT UNSIGNED NOT NULL,
    `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT `devices_id_primary_key` PRIMARY KEY (`id`),
    CONSTRAINT `devices_uuid_unique_key` UNIQUE (`uuid`),
    CONSTRAINT `devices_ip_ua_user_id_unique_key` UNIQUE (`ip`, `ua`, `user_id`),
    CONSTRAINT `devices_account_id_foreign_key` FOREIGN KEY (`account_id`) REFERENCES `accounts` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT `devices_user_id_foreign_key` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
  ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;

--- // ---

-- Down

DROP TABLE IF EXISTS `devices`;
